<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Good Gamers — Portal</title>
  <link rel="stylesheet" href="portal.css">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body { display:flex; align-items:center; justify-content:center; min-height:100vh; padding:20px; }
    .login-wrap { width:100%; max-width:400px; }
    .login-logo { text-align:center; margin-bottom:36px; }
    .wordmark { font-family:var(--font-head); font-size:3.5rem; letter-spacing:6px; color:var(--cyan); text-shadow:0 0 40px rgba(0,200,255,0.5); line-height:1; }
    .word-sub { font-size:0.7rem; letter-spacing:3px; text-transform:uppercase; color:var(--text-dim); margin-top:8px; }
    .glow-line { width:60px; height:2px; background:var(--cyan); margin:16px auto 0; box-shadow:0 0 12px var(--cyan); }
    .login-card { background:var(--surface); border:1px solid var(--border); border-radius:14px; padding:32px; }
    .login-card h2 { font-family:var(--font-head); font-size:1.3rem; letter-spacing:2px; margin-bottom:6px; }
    .login-card p { font-size:0.82rem; color:var(--text-dim); margin-bottom:24px; }
    .new-note { text-align:center; font-size:0.78rem; color:var(--text-dim); margin-top:14px; }
    .admin-link { text-align:center; margin-top:20px; }
    .admin-link a { font-size:0.78rem; color:var(--text-dim); text-decoration:none; display:inline-flex; align-items:center; gap:5px; padding:7px 16px; border:1px solid var(--border); border-radius:6px; transition:all 0.15s; }
    .admin-link a:hover { color:var(--red); border-color:rgba(255,59,92,0.3); background:rgba(255,59,92,0.06); }
    .already-in { background:var(--surface); border:1px solid var(--border); border-radius:10px; padding:14px 18px; margin-bottom:16px; display:none; align-items:center; justify-content:space-between; gap:10px; }
    .already-in .name { font-weight:700; color:var(--cyan); }
    .already-in .actions { display:flex; gap:8px; }
  </style>
</head>
<body>
<div class="login-wrap">
  <div class="login-logo">
    <div class="wordmark">GOOD<br>GAMERS</div>
    <div class="word-sub">Tournament Platform</div>
    <div class="glow-line"></div>
  </div>

  <!-- Show this if already logged in -->
  <div class="already-in" id="alreadyIn">
    <div>
      <div style="font-size:0.68rem;letter-spacing:1.5px;text-transform:uppercase;color:var(--text-dim);margin-bottom:2px">Logged in as</div>
      <div class="name" id="loggedInName"></div>
    </div>
    <div class="actions">
      <a href="dashboard.html" class="btn btn-cyan btn-sm">Go to Portal →</a>
      <button class="btn btn-ghost btn-sm" onclick="logoutNow()">Sign Out</button>
    </div>
  </div>

  <div class="login-card" id="loginCard">
    <h2>PLAYER LOGIN</h2>
    <p>Enter your username and WhatsApp. New players are registered automatically.</p>
    <div id="msgArea"></div>
    <div class="form-row">
      <label class="form-label">Username</label>
      <input type="text" id="username" class="form-input" placeholder="e.g. CasperGG" autocomplete="off">
    </div>
    <div class="form-row">
      <label class="form-label">WhatsApp Number</label>
      <input type="tel" id="whatsapp" class="form-input" placeholder="e.g. 0501234567">
    </div>
    <button class="btn btn-cyan btn-lg" id="loginBtn" style="width:100%" onclick="login()">Enter Portal →</button>
    <div class="new-note">First time? Just pick a username + your WhatsApp to get started.</div>
  </div>

  <div class="admin-link">
    <a href="admin.html">⚡ Admin Panel</a>
  </div>
</div>
<script>
  // If already logged in, show the "already in" bar instead of auto-redirecting
  const saved = localStorage.getItem('sg_player');
  if (saved) {
    const p = JSON.parse(saved);
    document.getElementById('alreadyIn').style.display = 'flex';
    document.getElementById('loggedInName').textContent = p.username;
    document.getElementById('loginCard').style.opacity = '0.45';
    document.getElementById('loginCard').style.pointerEvents = 'none';
  }

  function logoutNow() {
    localStorage.removeItem('sg_player');
    document.getElementById('alreadyIn').style.display = 'none';
    document.getElementById('loginCard').style.opacity = '1';
    document.getElementById('loginCard').style.pointerEvents = '';
  }

  document.addEventListener('keydown', e => { if(e.key==='Enter') login(); });

  async function login() {
    const username = document.getElementById('username').value.trim();
    const whatsapp = document.getElementById('whatsapp').value.trim();
    const msg = document.getElementById('msgArea');
    if (!username || !whatsapp) { msg.innerHTML='<div class="alert alert-error">Fill in both fields.</div>'; return; }
    const btn = document.getElementById('loginBtn');
    btn.disabled = true; btn.innerHTML = '<span class="spinner"></span>&nbsp;Signing in...';
    try {
      const res = await fetch('/api/players/login', {
        method:'POST', headers:{'Content-Type':'application/json'},
        body: JSON.stringify({username, whatsapp})
      });
      const data = await res.json();
      if(!res.ok) throw new Error(data.message || 'Login failed');
      localStorage.setItem('sg_player', JSON.stringify(data.player));
      msg.innerHTML = `<div class="alert alert-success">${data.created?'Account created! Welcome!':'Welcome back, '+data.player.username+'!'}</div>`;
      setTimeout(()=>window.location.href='dashboard.html', 700);
    } catch(err) {
      msg.innerHTML = `<div class="alert alert-error">${err.message}</div>`;
      btn.disabled=false; btn.innerHTML='Enter Portal →';
    }
  }
</script>
</body>
</html>
